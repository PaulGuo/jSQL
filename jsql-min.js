(function(){var o=Array.prototype.slice,f=Object.prototype.toString,g=Object.prototype.hasOwnProperty;var j=Array.prototype.forEach,i=Array.isArray,a=Object.keys,l=Array.prototype.indexOf,d=Array.prototype.lastIndexOf;var n={};var h="jSQL_Key";var p,k,c,e={},m={},b={};if(typeof(this.jSQL)!=="undefined"){k=this.jSQL;}if(typeof(this.jsql)!=="undefined"){c=this.jsql;}p=function(){this.init.apply(this,arguments);};p.prototype={version:"0.4.0-dev",init:function(){this._jSQL=k;this._jsql=c;this._DB=e;this._currentDB=null;this._buffer=null;this._DBIndexMap=m;this._protected=b;this.utils=n;},create:function(s,r){var q;if(this._DB.hasOwnProperty(s)){throw ("DB Already Exist.");}if(n.isArray(r)){q=n.listSlice(arguments,"2:");n.appendKey(r,q);m[s]=n.arrayToObject(r);}if(n.isPlainObject(r)){m[s]=n.clone(r);r=n.objectToArray(r);}this._DB[s]=r;return this;},use:function(q){if(!this._DB.hasOwnProperty(q)){throw ("Database Not Exist.");}this._currentDB=this._DB[q];this._currentDBName=q;this.rebase();return this;},drop:function(q){if(this._DB.hasOwnProperty(q)){delete this._DB[q];}},dbs:function(){return n.keys(this._DB);},db:function(){return this._currentDBName;},select:function(q){if(!this._currentDB){throw ("Please Select Database First.");}this._buffer=this._currentDB;this._protected.field=[].slice.call(n.isArray(q)?q:arguments);if(q==="*"){return this;}return this;},count:function(){var q;q=this._buffer.length;this.rebase();return q;},total:function(t){var q=0,s;for(var r in this._currentDB){if(this._currentDB.hasOwnProperty(r)){s=t==="*"?this._currentDB[r]:typeof(t)==="function"?t.call(this,this._currentDB[r],r)===true?true:undefined:n.deep(this._currentDB[r],t);if(typeof(s)!=="undefined"){q++;}}}return q;},orderby:function(s,u,q){var r=this._buffer;var t=this;if(typeof(u)!=="function"){u=[q,q=u][0];}r.sort(function(w,v){w=n.deep(w,s);v=n.deep(v,s);if(u){w=u(w);v=u(v);}return q&&q.toLowerCase()==="asc"?w-v:v-w;});this._buffer=r;return this;},where:function(s){var r=[],t;this._buffer=this._buffer||this._currentDB;s=n.parseFn(s);for(var q in this._buffer){if(this._buffer.hasOwnProperty(q)){if(typeof(s)==="function"){t=s.call(this,n.clone(this._buffer[q]),q);}if(n.isArray(s)){t=false;for(var u in s){if(s.hasOwnProperty(u)){if(s[u].call(this,n.clone(this._buffer[q]),q)){t=true;}}}}if(t){r.push(n.clone(this._buffer[q]));}}}this._buffer=r;return this;},iterate:function(r){var s;this._buffer=this._buffer||this._currentDB;for(var q in this._buffer){if(this._buffer.hasOwnProperty(q)){s=r.call(this,this._buffer[q]);if(s){this.update(q,s);}}}return this;},findAll:function(){var q;q=n.clone(n.arrayToObject(this._select()));this.rebase();return q;},find:function(s){var q;var t=this._DBIndexMap[this._currentDBName];if(!s){for(var r in t){if(t.hasOwnProperty(r)){if(s){break;}if(this._buffer.hasOwnProperty(r)){s=r;}}}}q=n.clone(t[s]);this.rebase();return q;},listAll:function(){var q;q=n.clone(this._select());this.rebase();return q;},update:function(q,r){if(!this._currentDB){throw ("Please Select Database First.");}if(this._currentDB.hasOwnProperty(q)){this._currentDB[q]=r;}},insert:function(){},limit:function(t,r){var s=this._buffer;var q;if(!r){t=[0,r=t][0];}q=t+":"+(t+r);this._buffer=n.listSlice(s,q);return this;},keys:function(){return n.keys(this.findAll());},first:function(q){if(q){return this.where(q).first();}return n.listSlice(this._select(),":1");},last:function(q){if(q){return this.where(q).last();}return n.listSlice(this._select(),"-1:");},rebase:function(){this._protected={};this.select("*");return this;},noConflict:function(){if(window.jSQL===p){window.jSQL=this._jSQL;}if(window.jsql===jsql){window.jsql=this._jsql;}return this;},_select:function(s){var r,q=[];s=s||this._protected.field;if(s==="*"||(s.join&&s.join("")==="*")){return this._buffer;}if(typeof(s)==="string"){s=s.split(",");}n.each(this._buffer,function(v,t,u){r={};r[h]=n.deep(v,h);n.each(s,function(w,x,y){if(v.hasOwnProperty(w)){r[w.split(".").pop()]=n.deep(v,w);}});q.push(r);});return q;}};n={deep:function(t,s){var r=t,s=s.split(".");for(var q=0;q<s.length;q++){r=r[s[q]];}return r;},isArray:i||function(q){return f.call(q)==="[object Array]";},isObject:function(q){return q===Object(q);},isPlainObject:function(q){return this.isObject(q)&&q.constructor===Object;},clone:function(s){if(s==null||typeof(s)!="object"){return s;}var q=new s.constructor();for(var r in s){q[r]=arguments.callee(s[r]);}return q;},objectToArray:function(q){var s=[],q=this.clone(q);for(var r in q){if(q.hasOwnProperty(r)){q[r][h]=r;s.push(q[r]);}}return s;},arrayToObject:function(t,s){var q={};for(var r=0;r<t.length;r++){q[t[r][s||h]]=this.clone(t[r]);delete q[t[r][s||h]][s||h];}return q;},each:function(s,r){if(j){s.forEach(r);return;}for(var q=0;q<s.length;q++){r(s[q],q,s);}},keygen:function(r,q){var t=this;var u=[].slice.call(arguments,1);var s="";if(t.isArray(q)){u=q;}t.each(u,function(x,v,w){s+=n.deep(r,x);});return s;},listSlice:function(s,r){var t,q;s=[].slice.call(s);r=r.split(":");t=r[0]||0;q=r.length>1?r[1]||s.length:s.length;return[].slice.call(s,t,q);},appendKey:function(s,q){var r=this;r.each(s,function(v,t,u){v[h]=r.keygen(v,q)||t;});},keys:a||(function(){var u=true,r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],q=r.length;for(var s in {toString:null}){u=false;}return function t(x){if((typeof x!="object"&&typeof x!="function")||x===null){throw new TypeError("Object.keys called on a non-object");}var A=[];for(var w in x){if(x.hasOwnProperty(w)){A.push(w);}}if(u){for(var y=0,z=q;y<z;y++){var v=r[y];if(x.hasOwnProperty(v)){A.push(v);}}}return A;};})(),parseFn:function(q){if(typeof(q)==="string"){q=new Function("data","with(data) { return "+q+"; }");}return q;},indexOf:function(u,r){if(l){return l.apply(u,this.listSlice(arguments,"1:"));}var q=u,t=q.length>>>0;if(!t){return -1;}var s=0;if(arguments.length>2){s=arguments[2];}s=s>=0?s:Math.max(0,t+s);for(;s<t;s++){if(s in q&&q[s]===r){return s;}}return -1;}};p=new p();typeof(module)!=="undefined"&&module.exports?module.exports=p:this.jsql=this.jSQL=p;})();